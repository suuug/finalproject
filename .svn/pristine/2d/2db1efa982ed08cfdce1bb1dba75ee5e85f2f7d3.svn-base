<%@ page language="java" contentType="text/html; charset=UTF-8"  pageEncoding="UTF-8"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<style>

</style>

<div class="row">
	<div class="col-lg-12">
		<div class="card">
			<div class="card-body">
			
				<%@ include file="includeTab.jsp" %>
					                      
               	<div class="row">
               		
					<div class="col-lg-2">
						<%@ include file="includeSide.jsp" %>	
					</div> <!-- col end -->
					
					<div class="col-lg-9 ">
						<div class="row">
<!-- 							<div class="col-2 alert alert-primary" role="alert"> -->
<!-- 								  ÏµúÏÜå Ìïú Í∞ú  -->
<!-- 							</div> -->
							<div class="col-4">
                                <form class="app-search d-none d-lg-block">
		                            <div class="position-relative">
		                                <input type="text" class="form-control" placeholder="Search...">
		                                <span class="ri-search-line"></span>
		                            </div>
                        		</form>
                            </div>	
							<div class="col-6">
								<button type="button" id="insertWorkBtn" class="btn btn-dark btn-rounded waves-effect waves-light">
									ÏóÖÎ¨¥Ï∂îÍ∞Ä
								</button>
							</div>
						</div><!-- row end -->
						
						<div class="row">
							<div class="table">
	                            <table id="selection-datatable" class="table dt-responsive nowrap w-100">
	                                <thead>
	                                    <tr>
	                                        <th>Î≤àÌò∏</th>
	                                        <th>ÏÉÅÌÉú</th>
	                                        <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
	                                        <th>ÏóÖÎ¨¥ÎÇ¥Ïö©</th>
	                                        <th>Îã¥ÎãπÏûê</th>
	                                        <th>ÏàòÏ†ïÏùºÏãú</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="tbody">
									
	                                  	
	                            
	                                </tbody>
	                            </table>
	                        
	                        </div> <!-- end table-->
							
						</div><!-- row end -->
						
					</div> <!-- col end -->
					
            	</div><!-- end row-->
			</div> <!-- end card body-->
		</div> <!-- end card -->
	</div>
</div>
		
<!-- 	<div class="alert alert-primary alert-dismissible fade" role="alert"> -->
<!-- 		<font style="vertical-align: inherit;"> -->
<!-- 			<font style="vertical-align: inherit;"> -->
<!--         	ÏµúÏÜå Ìïú Í∞ú Ïù¥ÏÉÅ Ï≤¥ÌÅ¨ÌïòÏÑ∏Ïöî! -->
<!--         	</font> -->
<!--         </font> -->
<!--         <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Îã´Í∏∞"> -->
<!--         </button> -->
<!--     </div> -->
	

	
	<!-- insert Modal -->
	<div class="modal" id="insertWorkModal" tabindex="-1">
		<div class="modal-dialog" >
			<div class="modal-content">
				<form:form modelAttribute="projWorkVO" method="POST" action="/project/insertWork" enctype="multipart/form-data">
					<div class="modal-header">
						<h5 class="modal-title">ÏóÖÎ¨¥Ï∂îÍ∞Ä</h5>
						
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
							<form:hidden path="projId" value="${projWorkVO.projId }"/>						
							<sec:authentication property="principal.user" var="user"/>				
							<form:hidden path="workRqstr" value="${user.username }"/>		
						<div class="row p-3">
							<form:input class="form-control form-control-lg" path="workTitle" placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />						
						</div>
						<div class="row p-3">
							<div class="col-2">
								<i class="fas fa-clock fa-2x "></i>
							</div>
							<div class="col-10">
								<form:hidden path="workState" />						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ÏöîÏ≤≠</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ÏßÑÌñâ</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ÏôÑÎ£å</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">Ïù¥Ïäà</button>						
							</div>
						</div>
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-user-alt fa-2x "></i>
								</div>
								<div class="col-9 dropdown">
									<div class="col-auto"> 	
									
									  <button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropMember" data-bs-toggle="dropdown" aria-expanded="false">
									    Îã¥ÎãπÏûê
									  </button>
									<ul class="dropdown-menu" aria-labelledby="dropMember">
									 	<c:forEach var="empVO" items="${list }">
										<li><a class="dropdown-item projmem" href="#" data-empId="${empVO.empId }">${empVO.empName }</a></li>
										</c:forEach>
									</ul>
									</div>
									<div id="mngrDiv" class="col-auto"> </div>
								</div> 
							</div>
						</div> 
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workStrtDt" class="dateLabel">ÏãúÏûëÏùºÏûê</label>
									<form:input class="form-control" path="workStrtDt" type="date" />						
								
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workEndDt" class="dateLabel">ÎßàÍ∞êÏùºÏûê</label>
									<form:input class="form-control" path="workEndDt" type="date" />						
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-flag fa-2x "></i>
								</div>
								<div class="col-10 dropdown">
									<form:hidden path="workPriority" />						
									<button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropPriority" data-bs-toggle="dropdown" aria-expanded="false">
									    ÏóÖÎ¨¥ÏàúÏúÑ
									 </button>
									<ul class="dropdown-menu" aria-labelledby="dropPriority">
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ÎÇÆÏùå" ><i class="fa fa-arrow-down icon"  style="color:orange"></i>ÎÇÆÏùå</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "Î≥¥ÌÜµ"><span class="icon">‚ûñ</span>Î≥¥ÌÜµ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ÎÜíÏùå" ><i class="fa fa-arrow-up icon"  style="color:green"></i>ÎÜíÏùå</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "Í∏¥Í∏â" ><span class="icon">üö®</span>Í∏¥Í∏â</a></li>
									</ul>
								</div>    
							
							</div>
						</div>
						
						<div class="p-3">
							<form:textarea path="workCntnt" class="form-control"  rows="5" placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
						</div>
						
						<div class="p-3">
							<input type="file" class="form-control" name="uploadFile" multiple />
						</div>
						
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Ï∑®ÏÜå</button>
						<button type="submit" id="okBtn" class="btn btn-primary">ÌôïÏù∏</button>
					</div>
					<sec:csrfInput/>
				</form:form>	
			</div>
		</div>
	</div> <!-- end insert Modal  -->
	

     <!-- detail offcanvas -->
     <div class="offcanvas offcanvas-end" tabindex="-1" id="wokrDetail" aria-labelledby="wokrDetailLabel">
         <div class="offcanvas-header">
           <h5 id="wokrDetailLabel">ÏóÖÎ¨¥Ï†úÎ™©</h5>

         
           <div class="col-2">
           <a href="#" id="editBtn" class="text-primary" data-bs-dismiss="offcanvas"  data-bs-toggle="tooltip" data-bs-placement="top" title="Edit"><i id="wkUpdate" class="mdi mdi-pencil font-size-18"></i></a>
           <a href="#" id="delBtn" class="text-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete"><i id="wkdelete" class="mdi mdi-trash-can font-size-18"></i></a>
           
           <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
           </div>
         </div>
         <div class="offcanvas-body">
           		<form:form modelAttribute="projWorkVO" method="POST" action="/project/">
							<form:hidden path="projId" value="${projWorkVO.projId }"/>						
							<form:hidden path="workRqstr" value=""/>
							<form:hidden path="workId" value=""/>			
<!-- 					<div class="p-3"> -->
<%-- 						<form:input path="workCntnt" class="form-control"  rows="5" placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />  --%>
<!-- 					</div> -->
					<div class="p-3">
						<form:textarea path="workCntnt" class="form-control"  rows="5" placeholder="" />
					</div>
					
					<div class="row p-3">
						<div class="col-2">
							<i class="fas fa-clock fa-2x "></i>
						</div>
						<div class="col-10">
							<form:hidden path="workState" />						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="request">ÏöîÏ≤≠</button>						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="ing">ÏßÑÌñâ</button>						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="complete">ÏôÑÎ£å</button>						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="issue">Ïù¥Ïäà</button>						
						</div>
					</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-user-alt fa-2x "></i>
								</div>
								<div class="col-9 dropdown">
									<div class="col-auto"> 	
									
									  <button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropMember" data-bs-toggle="dropdown" aria-expanded="false">
									    Îã¥ÎãπÏûê
									  </button>
									<ul class="dropdown-menu" aria-labelledby="dropMember">
									 	<c:forEach var="empVO" items="${list }">
										<li><a class="dropdown-item projmem" href="#" data-empId="${empVO.empId }">${empVO.empName }</a></li>
										</c:forEach>
									</ul>
									</div>
									<div id="mngrDiv" class="col-auto"> </div>
								</div> 
							</div>
						</div> 
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workStrtDt" class="dateLabel">ÏãúÏûëÏùºÏûê</label>
									<input type="hidden" class="form-control" name="oldWorkStrtDt" type="date" />						
									<form:input class="form-control" path="workStrtDt" type="date" />
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workEndDt" class="dateLabel">ÎßàÍ∞êÏùºÏûê</label>
									<input type="hidden" class="form-control" name="oldWorkEndDt" type="date" />						
									<form:input class="form-control" path="workEndDt" type="date" />						
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-flag fa-2x "></i>
								</div>
								<div class="col-10 dropdown">
									<form:hidden path="workPriority" />						
									<button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropPriority" data-bs-toggle="dropdown" aria-expanded="false">
									    ÏóÖÎ¨¥ÏàúÏúÑ
									 </button>
									<ul class="dropdown-menu" aria-labelledby="dropPriority">
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ÎÇÆÏùå" ><i class="fa fa-arrow-down icon"  style="color:orange"></i>ÎÇÆÏùå</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "Î≥¥ÌÜµ"><span class="icon">‚ûñ</span>Î≥¥ÌÜµ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ÎÜíÏùå" ><i class="fa fa-arrow-up icon"  style="color:green"></i>ÎÜíÏùå</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "Í∏¥Í∏â" ><span class="icon">üö®</span>Í∏¥Í∏â</a></li>
									</ul>
								</div>    
							
							</div>
						</div>
					
<!-- 					<div class="modal-footer"> -->
<!-- 						<button type="button" class="btn btn-secondary" -->
<!-- 							data-bs-dismiss="modal">Ï∑®ÏÜå</button> -->
<!-- 						<button type="submit" id="okBtn" class="btn btn-primary">ÌôïÏù∏</button> -->
<!-- 					</div> -->
					<sec:csrfInput/>
				</form:form>
         </div>
     </div> <!-- end detail offcanvas -->
	

    <!-- update Modal -->
	<div class="modal" id="updateWorkModal" tabindex="-1">
		<div class="modal-dialog" >
			<div class="modal-content">
				<form:form modelAttribute="projWorkVO" method="POST" action="/project/updateWork" enctype="multipart/form-data">
					<div class="modal-header">
						<h5 class="modal-title">ÏóÖÎ¨¥ÏàòÏ†ï</h5>
						
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
							<form:hidden path="projId" value="${projWorkVO.projId }"/>						
							<form:hidden path="workId" value=""/>		
							<sec:authentication property="principal.user" var="user"/>				
							<form:hidden path="workRqstr" value="${user.username }"/>		
						<div class="row p-3">
							<form:input class="form-control form-control-lg" path="workTitle" placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />						
						</div>
						<div class="row p-3">
							<div class="col-2">
								<i class="fas fa-clock fa-2x "></i>
							</div>
							<div class="col-10">
								<form:hidden path="workState" />						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="request">ÏöîÏ≤≠</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="ing">ÏßÑÌñâ</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="complete">ÏôÑÎ£å</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="issue">Ïù¥Ïäà</button>									
							</div>
						</div>
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-user-alt fa-2x "></i>
								</div>
								<div class="col-9 dropdown">
									<div class="col-auto"> 	
									
									  <button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropMember" data-bs-toggle="dropdown" aria-expanded="false">
									    Îã¥ÎãπÏûê
									  </button>
									<ul class="dropdown-menu" aria-labelledby="dropMember">
									 	<c:forEach var="empVO" items="${list }">
										<li><a class="dropdown-item projmem" href="#" data-empId="${empVO.empId }">${empVO.empName }</a></li>
										</c:forEach>
									</ul>
									</div>
									<div id="mngrDiv" class="col-auto"> </div>
								</div> 
							</div>
						</div> 
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workStrtDt" class="dateLabel">ÏãúÏûëÏùºÏûê</label>
									<form:input class="form-control" path="workStrtDt" type="date" />						
								
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workEndDt" class="dateLabel">ÎßàÍ∞êÏùºÏûê</label>
									<form:input class="form-control" path="workEndDt" type="date" />						
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-flag fa-2x "></i>
								</div>
								<div class="col-10 dropdown">
									<form:hidden path="workPriority" />						
									<button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropPriority" data-bs-toggle="dropdown" aria-expanded="false">
									    ÏóÖÎ¨¥ÏàúÏúÑ
									 </button>
									<ul class="dropdown-menu" aria-labelledby="dropPriority">
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ÎÇÆÏùå" ><i class="fa fa-arrow-down icon"  style="color:orange"></i>ÎÇÆÏùå</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "Î≥¥ÌÜµ"><span class="icon">‚ûñ</span>Î≥¥ÌÜµ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ÎÜíÏùå" ><i class="fa fa-arrow-up icon"  style="color:green"></i>ÎÜíÏùå</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "Í∏¥Í∏â" ><span class="icon">üö®</span>Í∏¥Í∏â</a></li>
									</ul>
								</div>    
							
							</div>
						</div>
						
						<div class="p-3">
							<form:textarea path="workCntnt" class="form-control"  rows="5" placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
						</div>
						
						<div class="p-3">
							<input type="file" class="form-control" name="uploadFile" multiple />
						</div>
						
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Ï∑®ÏÜå</button>
						<button type="submit" id="okBtn" class="btn btn-primary">ÌôïÏù∏</button>
					</div>
					<sec:csrfInput/>
				</form:form>	
			</div>
		</div>
	</div> <!-- end insert Modal  -->
	
<script type="text/javascript">
// function datailCilck(){
// 	console.log();
// }
function removeClass(p_obj, p_list){
//	 	console.log(p_obj);
	for(var i=0; i<p_list.length; i++){
		$(p_obj).removeClass(p_list[i]);
//	 		console.log(p_list[i]);
	}
}

function toStringByFormat(date) { 
	var year = date.getFullYear();
	var month = ('0' + (date.getMonth() + 1)).slice(-2);
	var day = ('0' + date.getDate()).slice(-2);

	var dateString = year + '-' + month  + '-' + day;
	
	return dateString;
}
	

function wkStateBtnClick(p_btn){
	var wkState = $(p_btn).text();
	var removeList = ["btn-info", "btn-success", "btn-dark", "btn-danger"];
	removeClass(".wkStateBtn", removeList);

	$(".wkStateBtn").addClass("btn-secondary"); 
	
	if(wkState=="ÏöîÏ≤≠"){
	$(p_btn).addClass("btn-info");
	}
	if(wkState=="ÏßÑÌñâ"){
	$(p_btn).addClass("btn-success");
	}
	if(wkState=="ÏôÑÎ£å"){
	$(p_btn).addClass("btn-dark");
	}
	if(wkState=="Ïù¥Ïäà"){
	$(p_btn).addClass("btn-danger");
	}
	
	$("#workState").val(wkState);
}

function priorityBtnClick(p_btn){
	var priority = $(p_btn).data("priority")
	
	var priorityBtn = $(p_btn).parents('.dropdown').find("#dropPriority");
	
	
	var removeList = ["btn-outline-secondary", "btn-outline-warning", "btn-outline-dark", "btn-outline-success", "btn-outline-danger"];
	removeClass(priorityBtn, removeList)

	
	var code = "";
	if(priority=="ÎÇÆÏùå"){
		code += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ÎÇÆÏùå'; 	
		priorityBtn.html(code);
		priorityBtn.addClass("btn-outline-warning"); 
	}
	if(priority=="Î≥¥ÌÜµ"){
		priorityBtn.text($(p_btn).text());
		priorityBtn.addClass("btn-outline-dark"); 
		
	}
	if(priority=="ÎÜíÏùå"){
			
		code += '<i class="fa fa-arrow-down icon" style="color:green"></i>ÎÜíÏùå'; 	
		priorityBtn.html(code);
		
		priorityBtn.addClass("btn-outline-success"); 
		
	}
	if(priority=="Í∏¥Í∏â"){
		priorityBtn.text($(p_btn).text());
		priorityBtn.addClass("btn-outline-danger"); 
			
	}
	
	$(p_btn).parents('.dropdown').find('input[name=workPriority]').val(priority);

// 	$("input[name='workPriority']").val(priority);
}
$(function(){

// 	$('[data-toggle="tooltip"]').tooltip();   

	// ajax Post ÏÇ¨Ïö©Ïãú Í∞ôÏù¥ Î≥¥ÎÇº ÌÜ†ÌÅ∞Ìó§Îçî 
	var token = '${_csrf.token}'
	var header = '${_csrf.headerName}'
	
	// Î¶¨Ïä§Ìä∏ Í∞ÄÏ†∏Ïò§Í∏∞
	workList();
	 
	// ÏóÖÎ¨¥Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú Î™®Îã¨ Î≥¥Ïó¨Ïßê
	$("#insertWorkBtn").on("click", function(){
		$("#insertWorkModal").modal("show");
		
		$("#mngrDiv").empty();
	})
	
	// ------------Ïù∏ÏÑúÌä∏ ÏóÖÎç∞Ïù¥Ìä∏ Î™®Îã¨ÏïàÏóêÏÑú Ïù¥Î≤§Ìä∏---------------
	// Îã¥ÎãπÏûê ÌÅ¥Î¶≠Ïãú Ìï¥Îãπ Îã¥ÎãπÏûê Ï∂îÍ∞ÄÎê® 
	$(".projmem").on("click", function(){
		var memlist = [];
		memlist = $(".membtn");
		
		// Ï§ëÎ≥µÏù¥Î¶Ñ ÏÑ†ÌÉùÏãú Î¶¨ÌÑ¥
		for(var i=0; i<memlist.length; i++){
			if($(this).text()==memlist[i].innerText){
				return false;
			}
		}
		
		// Ïù¥Î¶ÑÎì§Ïñ¥Í∞Ñ Î≤ÑÌäº ÎßåÎì§Í∏∞
		var btn = "<button type='button' class='btn btn-outline-info waves-effect waves-light membtn'>";
		btn += "<i class='ri-close-line align-middle me-2'></i>";
		btn += $(this).text();
		btn += "</button>";
		// ÏÑ†ÌÉùÌïú Ïù¥Î¶Ñ VOÏóê Îì§Ïñ¥Í∞à Ïàò ÏûàÍ≤å ÌûàÎì†ÏúºÎ°ú ÎÑ£Ïñ¥ÎÜìÍ∏∞
		btn += '<input id="workMngr" name="workMngr" value="'+$(this).data("empId")+'" type="hidden">';
		var mngrDiv = $(this).parents(".dropdown").find("#mngrDiv")
		
		$(mngrDiv).append(btn);
		
	})
	
	// Ï∂îÍ∞ÄÎêú Îã¥ÎãπÏûêÎ≤ÑÌäºÏóê ÏûàÎäî xÌÅ¥Î¶≠Ïãú Îã¥ÎãπÏûê ÏÇ≠Ï†úÎê®
	$(document).on("click","#insertWorkModal .ri-close-line, #updateWorkModal .ri-close-line", function(){
// 		console.log($(this).parents(".btn"));
		var memBtn = $(this).parents(".btn")[0];
// 		console.log($(this).parents(".btn")[0].innerText);
		var memNm = memBtn.innerText;
		// ÌûàÎì†ÌÉúÌÅ¨ ÏóÜÏï†Í∏∞
		$(memBtn).parents("#mngrDiv").find("input[value="+memNm+"]").remove();
		// Î≤ÑÌäº ÏóÜÏï†Í∏∞
		$(memBtn).remove();
	})
	
	// ÏóÖÎ¨¥Ïö∞ÏÑ†ÎèÑ ÌÅ¥Î¶≠Ïãú 
	$("#insertWorkModal .priorityBtn, #updateWorkModal .priorityBtn").on("click", function(){
// 		console.log($(this).attr("priority"));
		priorityBtnClick(this);
// 		$(this).parents('.dropdown').find('input[name=workPriority]').val(priority);
		
	})
	
	// ÏóÖÎ¨¥ÏÉÅÌÉú Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú 
	$("#insertWorkModal .wkStateBtn, #updateWorkModal .wkStateBtn").on("click", function(){
		wkStateBtnClick(this);

	})
	
	// ------------Ïù∏ÏÑúÌä∏ ÏóÖÎç∞Ïù¥Ìä∏ Î™®Îã¨ÏïàÏóêÏÑú Ïù¥Î≤§Ìä∏ ÎÅù---------------
// 	console.log(priorityList);
// 	console.log(wkStateList);
	
	// ÏÇ¨Ïù¥ÎìúÌÉ≠ ÌÅ¥Î¶≠Ïãú 
	$(".sideBox").on("click", function(){
		workList();
		
	})
	
	// ------------ÎîîÌÖåÏùº ÌÅ¥Î¶≠Ïãú Ïù¥Î≤§Ìä∏---------------
	$(document).on("click",".wkDetail", function(){
		console.log("*wkDetail test");
		var workId = $(this).children(".workId").text();
		console.log(workId);
		
		$.ajax({
			url: "/project/workDetail",
			type: "POST",
			dataType: "json",
			data: {
				'workId' : workId		
			},
			success: function(res) {
				console.log(res);
				// ÏóÖÎ¨¥ÏΩîÎìú
				$("#wokrDetail #workId").val(res.workId);
				// Ï†úÎ™©
				$("#wokrDetailLabel").text(res.workTitle);			
				// ÎÇ¥Ïö©
				$("#wokrDetail #workCntnt").text(res.workCntnt);
				// ÏÉÅÌÉú
				$("#wokrDetail #workState").val(res.workState);
				var removeList = ["btn-info", "btn-success", "btn-dark", "btn-danger"];
				removeClass(".wkStateBtn", removeList);
				
				if(res.workState=="ÏöîÏ≤≠"){
					$("#wokrDetail #request").addClass("btn-info");
				}
				if(res.workState=="ÏßÑÌñâ"){
					$("#wokrDetail #ing").addClass("btn-success");
				}
				if(res.workState=="ÏôÑÎ£å"){
					$("#wokrDetail #complete").addClass("btn-dark");
				}
				if(res.workState=="Ïù¥Ïäà"){
					console.log(res.workState);
					$("#wokrDetail #issue").addClass("btn-danger");
				}
				
				
				
				// Îã¥ÎãπÏûê
				$("#wokrDetail #mngrDiv").empty()
				for(var i=0; i<res.workMngr.length; i++){
					
					// Ïù¥Î¶ÑÎì§Ïñ¥Í∞Ñ Î≤ÑÌäº ÎßåÎì§Í∏∞
					var btn = "<button type='button' class='btn btn-outline-info waves-effect waves-light membtn'>";
					btn += "<i class='ri-close-line align-middle me-2'></i>";
					btn += res.workMngr[i];
					btn += "</button>";
					// ÏÑ†ÌÉùÌïú Ïù¥Î¶Ñ VOÏóê Îì§Ïñ¥Í∞à Ïàò ÏûàÍ≤å ÌûàÎì†ÏúºÎ°ú ÎÑ£Ïñ¥ÎÜìÍ∏∞
					btn += '<input id="workMngr" name="workMngr" value="'+ res.workMngr[i] +'" type="hidden">';
					
					$("#wokrDetail #mngrDiv").append(btn);
				}
				
				// ÎÇ†Ïßú
				var workStrtDt = toStringByFormat(new Date(res.workStrtDt))
				var workEndDt = toStringByFormat(new Date(res.workEndDt))
				$("#wokrDetail input[name=oldWorkStrtDt]").val(workStrtDt);
				$("#wokrDetail input[name=oldWorkEndDt]").val(workEndDt);
				$("#wokrDetail #workStrtDt").val(workStrtDt);
				$("#wokrDetail #workEndDt").val(workEndDt);
				
				// ÏóÖÎ¨¥ÏàúÏúÑ
				$("#wokrDetail #workPriority").val(res.workPriority);
				var removeList = ["btn-outline-secondary", "btn-outline-warning", "btn-outline-dark", "btn-outline-success", "btn-outline-danger"];
				removeClass("#wokrDetail #dropPriority", removeList)
				
				code = "";
				if(res.workPriority=="ÎÇÆÏùå"){
					code += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ÎÇÆÏùå'; 
					$("#wokrDetail #dropPriority").addClass("btn-outline-warning"); 
				}
				if(res.workPriority=="Î≥¥ÌÜµ"){
					code += '<span class="icon">‚ûñ</span>Î≥¥ÌÜµ'; 	
					$("#wokrDetail #dropPriority").addClass("btn-outline-dark"); 
					
				}
				if(res.workPriority=="ÎÜíÏùå"){
						
					code += '<i class="fa fa-arrow-down icon" style="color:green"></i>ÎÜíÏùå'; 	
					$("#wokrDetail #dropPriority").addClass("btn-outline-success"); 
					
				}
				if(res.workPriority=="Í∏¥Í∏â"){
					code += '<span class="icon">üö®</span>Í∏¥Í∏â'; 	
					$("#wokrDetail #dropPriority").addClass("btn-outline-danger"); 
						
				}
					$("#wokrDetail #dropPriority").html(code);
				
				
						
			},
			beforeSend:function(xhr) { 
				xhr.setRequestHeader(header, token)
			},
			error: function(xhr) {
				alert(xhr.status)
			
			}
		})
		
	})
	
	// ------------ÎîîÌÖåÏùº ÌÅ¥Î¶≠Ïãú Ïù¥Î≤§Ìä∏ ÎÅù---------------
	
	// ------------ÎîîÌÖåÏùº Ï∞Ω ÏïàÏóê Îç∞Ïù¥ÌÑ∞ ÌÅ¥Î¶≠Ïãú Ïù¥Î≤§Ìä∏ ----------
	// ÏÉÅÌÉúÎ≤ÑÌäº ÌÅ¥Î¶≠Ïãú
	$("#wokrDetail .wkStateBtn").on("click", function(){
		Swal.fire(
				{ title: 'ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?'
// 						, text: "Îã§Ïãú ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§. Ïã†Ï§ëÌïòÏÑ∏Ïöî."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'ÌôïÏù∏'
						, cancelButtonText: 'Ï∑®ÏÜå' 
				}).then((result) => { 
						if (result.isConfirmed) { 
							Swal.fire( '', 'ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.', 'success' ) 
							wkStateBtnClick(this);
						} 
				})
        	
	})	
	
	// Îã¥ÎãπÏûê XÌÅ¥Î¶≠Ïãú
	$(document).on("click", "#wokrDetail .ri-close-line", function(){
		Swal.fire(
				{ title: 'Îã¥ÎãπÏûêÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?'
// 						, text: "Îã§Ïãú ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§. Ïã†Ï§ëÌïòÏÑ∏Ïöî."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'ÌôïÏù∏'
						, cancelButtonText: 'Ï∑®ÏÜå' 
				}).then((result) => { 
						if (result.isConfirmed) { 
							$(this).parents(".btn").remove();
						} 
				})
        	
	})	
	// ÎÇ†ÏßúÎ≤ÑÌäº ÌÅ¥Î¶≠Ïãú
	$("#wokrDetail #workStrtDt").on('focusin', function(){
	    console.log("Saving value " + $(this).val());
	    $(this).data('old', $(this).val());
	});
	// ÏóÖÎ¨¥ÏÉÅÌÉú ÌÅ¥Î¶≠Ïãú
	$("#wokrDetail #workStrtDt").on("change", function(){
// 		alert($("#wokrDetail input[name=oldWorkStrtDt]").val());
		oldvalue =  $(this).data('old');
		Swal.fire(
				{ title: 'ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?'
// 						, text: "Îã§Ïãú ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§. Ïã†Ï§ëÌïòÏÑ∏Ïöî."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'ÌôïÏù∏'
						, cancelButtonText: 'Ï∑®ÏÜå' 
				}).then((result) => { 
						if (!result.isConfirmed) { 
// 							Swal.fire( '', 'ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.', 'success' ) 
							$(this).val(oldvalue);
						} 
				})
        	
	})
	
	// ÏóÖÎ¨¥Ïö∞ÏÑ†ÎèÑ ÌÅ¥Î¶≠Ïãú 
	$("#wokrDetail .priorityBtn").on("click", function(){
		Swal.fire(
				{ title: 'ÏóÖÎ¨¥ Ïö∞ÏÑ†ÎèÑÎ•º Î∞îÍæ∏ÏãúÍ≤†ÏäµÎãàÍπå?'
// 						, text: "Îã§Ïãú ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§. Ïã†Ï§ëÌïòÏÑ∏Ïöî."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'ÌôïÏù∏'
						, cancelButtonText: 'Ï∑®ÏÜå' 
				}).then((result) => { 
						if (result.isConfirmed) { 
							priorityBtnClick(this);
						} 
				})
		
	})
	
	// ÏàòÏ†ïÎ≤ÑÌäº ÌÅ¥Î¶≠Ïãú 
	$("#wokrDetail #wkUpdate").on("click", function(){
		$("#updateWorkModal").modal("show");
		console.log("*wkUpdate test");
		var workDetail = $(this).parents("#wokrDetail");
		var workId = workDetail.find("#workId").val();
		var workStartDt = workDetail.find("input[name=oldWorkStrtDt]").val();
		var workEndDt = workDetail.find("input[name=oldWorkEndDt]").val();
		var workState = workDetail.find("#workState").val();
		var workPriority = workDetail.find("#workPriority").val();
		var workTitle = workDetail.find("#wokrDetailLabel").text();
		var workCntnt = workDetail.find("#workCntnt").val();
		var workMngrObj = workDetail.find("input[name=workMngr]");
		var workMngr = []
		for(var i=0; i<workMngrObj.length; i++){
			workMngr.push(workMngrObj[i].value)
			console.log(workMngr[i]);
		}
		
		console.log(workId);
		console.log(workStartDt);
		console.log(workEndDt);
		console.log(workState);
		console.log(workPriority);
		console.log(workTitle);
		console.log(workCntnt);
		
		// ÏóÖÎ¨¥ÏΩîÎìú
		$("#updateWorkModal #workId").val(workId);
		// Ï†úÎ™©
		$("#updateWorkModal #workTitle").val(workTitle);			
		// ÎÇ¥Ïö©
		$("#updateWorkModal #workCntnt").text(workCntnt);
		// ÏÉÅÌÉú
		$("#updateWorkModal #workState").val(workState);
		var removeList = ["btn-info", "btn-success", "btn-dark", "btn-danger"];
		removeClass(".wkStateBtn", removeList);
		
		if(workState=="ÏöîÏ≤≠"){
			$("#updateWorkModal #request").addClass("btn-info");
		}
		if(workState=="ÏßÑÌñâ"){
			$("#updateWorkModal #ing").addClass("btn-success");
		}
		if(workState=="ÏôÑÎ£å"){
			$("#updateWorkModal #complete").addClass("btn-dark");
		}
		if(workState=="Ïù¥Ïäà"){
			$("#updateWorkModal #issue").addClass("btn-danger");
		}
		
		
		
		// Îã¥ÎãπÏûê
		$("#updateWorkModal #mngrDiv").empty()
		for(var i=0; i<workMngr.length; i++){
			
			// Ïù¥Î¶ÑÎì§Ïñ¥Í∞Ñ Î≤ÑÌäº ÎßåÎì§Í∏∞
			var btn = "<button type='button' class='btn btn-outline-info waves-effect waves-light membtn'>";
			btn += "<i class='ri-close-line align-middle me-2'></i>";
			btn += workMngr[i];
			btn += "</button>";
			// ÏÑ†ÌÉùÌïú Ïù¥Î¶Ñ VOÏóê Îì§Ïñ¥Í∞à Ïàò ÏûàÍ≤å ÌûàÎì†ÏúºÎ°ú ÎÑ£Ïñ¥ÎÜìÍ∏∞
			btn += '<input id="workMngr" name="workMngr" value="'+ workMngr[i] +'" type="hidden">';
			
			$("#updateWorkModal #mngrDiv").append(btn);
		}
		
		// ÎÇ†Ïßú
// 		var sworkStrtDt = toStringByFormat(new Date(workStrtDt))
// 		var sworkEndDt = toStringByFormat(new Date(workEndDt))
// 		$("#updateWorkModal input[name=oldWorkStrtDt]").val(workStrtDt);
// 		$("#updateWorkModal input[name=oldWorkEndDt]").val(workEndDt);
		$("#updateWorkModal #workStrtDt").val(workStartDt);
		$("#updateWorkModal #workEndDt").val(workEndDt);
		
		// ÏóÖÎ¨¥ÏàúÏúÑ
		$("#updateWorkModal #workPriority").val(workPriority);
		var removeList = ["btn-outline-secondary", "btn-outline-warning", "btn-outline-dark", "btn-outline-success", "btn-outline-danger"];
		removeClass("#updateWorkModal #dropPriority", removeList)
		
		code = "";
		if(workPriority=="ÎÇÆÏùå"){
			code += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ÎÇÆÏùå'; 
			$("#updateWorkModal #dropPriority").addClass("btn-outline-warning"); 
		}
		if(workPriority=="Î≥¥ÌÜµ"){
			code += '<span class="icon">‚ûñ</span>Î≥¥ÌÜµ'; 	
			$("#updateWorkModal #dropPriority").addClass("btn-outline-dark"); 
			
		}
		if(workPriority=="ÎÜíÏùå"){
				
			code += '<i class="fa fa-arrow-down icon" style="color:green"></i>ÎÜíÏùå'; 	
			$("#updateWorkModal #dropPriority").addClass("btn-outline-success"); 
			
		}
		if(workPriority=="Í∏¥Í∏â"){
			code += '<span class="icon">üö®</span>Í∏¥Í∏â'; 	
			$("#updateWorkModal #dropPriority").addClass("btn-outline-danger"); 
				
		}
			$("#updateWorkModal #dropPriority").html(code);
		
		
		
	})
	
	//---------------ÏàòÏ†ïÎ™®Îã¨ ÏïàÏóêÏÑú Ïù¥Î≤§Ìä∏ ---------------
	
	//---------------ÏàòÏ†ïÎ™®Îã¨ ÏïàÏóêÏÑú Ïù¥Î≤§Ìä∏ ÎÅù ---------------
	
	// ------------ÎîîÌÖåÏùº Ï∞Ω ÏïàÏóê Îç∞Ïù¥ÌÑ∞ ÌÅ¥Î¶≠Ïãú Ïù¥Î≤§Ìä∏ ÎÅù----------

	
	function workList(){
		
//		console.log($(this).val());
//		division = $(this).val();`
		var division = $("input[name='division']:checked").val();
//	 	console.log(division);
		
		var wkStateObj = $("input[name='wkState']:checked");
//	 	console.log(wkStateObj);
		
		var priorityObj = $("input[name='priority']:checked");
//	 	console.log(priorityObj);

		if(wkStateObj.length < 1 || priorityObj.length < 1){
			alert("ÏµúÏÜå Ìïú Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!")
			event.preventDefault()
			return false;
		}
		
		var wkStateList = []; 
		for(var i=0; i<wkStateObj.length; i++){
//	 		console.log(wkStateObj[i].value);
			wkStateList.push(wkStateObj[i].value)
		}
		
		var priorityList= []; 
		for(var i=0; i<priorityObj.length; i++){
//	 		console.log(wkStateObj[i].value);
			priorityList.push(priorityObj[i].value)
		}
		
		$.ajax({
			url: "/project/workList",
			type: "POST",
			contentType : "application/json; charset=utf-8",
			data: JSON.stringify({'empId' : "EMPL00004"
				,'projId' : "${projWorkVO.projId}"
				,'division' : division
				,'wkStateList' : wkStateList
				,'priorityList' : priorityList
			}),
			success: function(res) {
//					console.log(res);

				var tbody = "";
				$.each(res, function(i, v) {
					
//						var workId = "'" + v.workId + "'";
					tbody += '<tr class="wkDetail" data-bs-toggle="offcanvas" data-bs-target="#wokrDetail" aria-controls="wokrDetail" >';
					tbody += '<td class="workId" >'+v.workId+'</td>';
					tbody += '<td>';
					if(v.workState==null){
						tbody += '-';
					}
					if(v.workState=="ÏöîÏ≤≠"){
						tbody += '<button type="button" class="btn btn-sm btn-info btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					if(v.workState=="ÏßÑÌñâ"){
						tbody += '<button type="button" class="btn btn-sm btn-success btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					if(v.workState=="ÏôÑÎ£å"){
						tbody += '<button type="button" class="btn btn-sm btn-dark btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					if(v.workState=="Ïù¥Ïäà"){
						tbody += '<button type="button" class="btn btn-sm btn-danger btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					tbody += '</td>';
					
					// ÏàúÏúÑ
					if(v.workPriority==null){
						tbody += '<td>-</td>';
					}else{
		                tbody += '<td>';
						
						if(v.workPriority=="ÎÇÆÏùå"){
							tbody += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ÎÇÆÏùå'; 	
						}
						if(v.workPriority=="Î≥¥ÌÜµ"){
							tbody += '<span class="icon">‚ûñ</span>Î≥¥ÌÜµ'; 	
							
						}
						if(v.workPriority=="ÎÜíÏùå"){
							tbody += '<i class="fa fa-arrow-down icon" style="color:green"></i>ÎÜíÏùå'; 	
							
						}
						if(v.workPriority=="Í∏¥Í∏â"){
							tbody += '<span class="icon">üö®</span>Í∏¥Í∏â'; 	
								
						}
		                tbody += '</td>';
					}   
					
	                tbody += '<td>'+v.workTitle +'</td>';

	                if(v.workMngr.length == 1){
		                tbody += '<td>' + v.workMngr[0] + '</sapn></td>';
	                }else if(v.workMngr.length > 1){
		                tbody += '<td><span data-bs-toggle="tooltip" data-bs-placement="bottom" title="';
						for(var i=0; i < v.workMngr.length; i++){
							tbody += v.workMngr[i];
							if(i != (v.workMngr.length-1)){
								tbody += ", ";
							}
						}
		        
		                tbody += '">' + v.workMngr[0] + 'Ïô∏ '+ (v.workMngr.length-1) +'Î™Ö</sapn> </td>';
	                }else{
	                	tbody += '<td> - </td>';
	                	
	                }
	                
	                tbody += '<td>'+ toStringByFormat(new Date(v.workMdfyDt)) +'</td>';
	                tbody += '</tr>';
	                
	            
				})
				
				$("#tbody").html(tbody);
				
				var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
				var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
				  return new bootstrap.Tooltip(tooltipTriggerEl)
				})
				
			},
			error: function(xhr) {
				alert(xhr.status)

			},
			beforeSend:function(xhr) { 
				xhr.setRequestHeader(header, token)
			},
			dataType: "json"
		})
	}	
	
	
})
</script>
