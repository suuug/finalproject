<%@ page language="java" contentType="text/html; charset=UTF-8"  pageEncoding="UTF-8"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<style>

</style>

<div class="row">
	<div class="col-lg-12">
		<div class="card">
			<div class="card-body">
			
				<%@ include file="includeTab.jsp" %>
					                      
               	<div class="row">
               		
					<div class="col-lg-2">
						<%@ include file="includeSide.jsp" %>	
					</div> <!-- col end -->
					
					<div class="col-lg-9 ">
						<div class="row">
<!-- 							<div class="col-2 alert alert-primary" role="alert"> -->
<!-- 								  ìµœì†Œ í•œ ê°œ  -->
<!-- 							</div> -->
							<div class="col-4">
                                <form class="app-search d-none d-lg-block">
		                            <div class="position-relative">
		                                <input type="text" class="form-control" placeholder="Search...">
		                                <span class="ri-search-line"></span>
		                            </div>
                        		</form>
                            </div>	
							<div class="col-6">
								<button type="button" id="insertWorkBtn" class="btn btn-dark btn-rounded waves-effect waves-light">
									ì—…ë¬´ì¶”ê°€
								</button>
							</div>
						</div><!-- row end -->
						
						<div class="row">
							<div class="table">
	                            <table id="selection-datatable" class="table dt-responsive nowrap w-100">
	                                <thead>
	                                    <tr>
	                                        <th>ë²ˆí˜¸</th>
	                                        <th>ìƒíƒœ</th>
	                                        <th>ìš°ì„ ìˆœìœ„</th>
	                                        <th>ì—…ë¬´ë‚´ìš©</th>
	                                        <th>ë‹´ë‹¹ì</th>
	                                        <th>ìˆ˜ì •ì¼ì‹œ</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="tbody">
									
	                                  	
	                            
	                                </tbody>
	                            </table>
	                        
	                        </div> <!-- end table-->
							
						</div><!-- row end -->
						
					</div> <!-- col end -->
					
            	</div><!-- end row-->
			</div> <!-- end card body-->
		</div> <!-- end card -->
	</div>
</div>
		
<!-- 	<div class="alert alert-primary alert-dismissible fade" role="alert"> -->
<!-- 		<font style="vertical-align: inherit;"> -->
<!-- 			<font style="vertical-align: inherit;"> -->
<!--         	ìµœì†Œ í•œ ê°œ ì´ìƒ ì²´í¬í•˜ì„¸ìš”! -->
<!--         	</font> -->
<!--         </font> -->
<!--         <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="ë‹«ê¸°"> -->
<!--         </button> -->
<!--     </div> -->
	

	
	<!-- insert Modal -->
	<div class="modal" id="insertWorkModal" tabindex="-1">
		<div class="modal-dialog" >
			<div class="modal-content">
				<form:form modelAttribute="projWorkVO" method="POST" action="/project/insertWork" enctype="multipart/form-data">
					<div class="modal-header">
						<h5 class="modal-title">ì—…ë¬´ì¶”ê°€</h5>
						
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
							<form:hidden path="projId" value="${projWorkVO.projId }"/>						
							<sec:authentication property="principal.user" var="user"/>				
							<form:hidden path="workRqstr" value="${user.username }"/>		
						<div class="row p-3">
							<form:input class="form-control form-control-lg" path="workTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />						
						</div>
						<div class="row p-3">
							<div class="col-2">
								<i class="fas fa-clock fa-2x "></i>
							</div>
							<div class="col-10">
								<form:hidden path="workState" />						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ìš”ì²­</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ì§„í–‰</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ì™„ë£Œ</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn">ì´ìŠˆ</button>						
							</div>
						</div>
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-user-alt fa-2x "></i>
								</div>
								<div class="col-9 dropdown">
									<div class="col-auto"> 	
									
									  <button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropMember" data-bs-toggle="dropdown" aria-expanded="false">
									    ë‹´ë‹¹ì
									  </button>
									<ul class="dropdown-menu" aria-labelledby="dropMember">
									 	<c:forEach var="empVO" items="${list }">
										<li><a class="dropdown-item projmem" href="#" data-empId="${empVO.empId }">${empVO.empName }</a></li>
										</c:forEach>
									</ul>
									</div>
									<div id="mngrDiv" class="col-auto"> </div>
								</div> 
							</div>
						</div> 
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workStrtDt" class="dateLabel">ì‹œì‘ì¼ì</label>
									<form:input class="form-control" path="workStrtDt" type="date" />						
								
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workEndDt" class="dateLabel">ë§ˆê°ì¼ì</label>
									<form:input class="form-control" path="workEndDt" type="date" />						
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-flag fa-2x "></i>
								</div>
								<div class="col-10 dropdown">
									<form:hidden path="workPriority" />						
									<button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropPriority" data-bs-toggle="dropdown" aria-expanded="false">
									    ì—…ë¬´ìˆœìœ„
									 </button>
									<ul class="dropdown-menu" aria-labelledby="dropPriority">
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë‚®ìŒ" ><i class="fa fa-arrow-down icon"  style="color:orange"></i>ë‚®ìŒ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë³´í†µ"><span class="icon">â–</span>ë³´í†µ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë†’ìŒ" ><i class="fa fa-arrow-up icon"  style="color:green"></i>ë†’ìŒ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ê¸´ê¸‰" ><span class="icon">ğŸš¨</span>ê¸´ê¸‰</a></li>
									</ul>
								</div>    
							
							</div>
						</div>
						
						<div class="p-3">
							<form:textarea path="workCntnt" class="form-control"  rows="5" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" />
						</div>
						
						<div class="p-3">
							<input type="file" class="form-control" name="uploadFile" multiple />
						</div>
						
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<button type="submit" id="okBtn" class="btn btn-primary">í™•ì¸</button>
					</div>
					<sec:csrfInput/>
				</form:form>	
			</div>
		</div>
	</div> <!-- end insert Modal  -->
	

     <!-- detail offcanvas -->
     <div class="offcanvas offcanvas-end" tabindex="-1" id="wokrDetail" aria-labelledby="wokrDetailLabel">
         <div class="offcanvas-header">
           <h5 id="wokrDetailLabel">ì—…ë¬´ì œëª©</h5>

         
           <div class="col-2">
           <a href="#" id="editBtn" class="text-primary" data-bs-dismiss="offcanvas"  data-bs-toggle="tooltip" data-bs-placement="top" title="Edit"><i id="wkUpdate" class="mdi mdi-pencil font-size-18"></i></a>
           <a href="#" id="delBtn" class="text-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete"><i id="wkdelete" class="mdi mdi-trash-can font-size-18"></i></a>
           
           <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
           </div>
         </div>
         <div class="offcanvas-body">
           		<form:form modelAttribute="projWorkVO" method="POST" action="/project/">
							<form:hidden path="projId" value="${projWorkVO.projId }"/>						
							<form:hidden path="workRqstr" value=""/>
							<form:hidden path="workId" value=""/>			
<!-- 					<div class="p-3"> -->
<%-- 						<form:input path="workCntnt" class="form-control"  rows="5" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" />  --%>
<!-- 					</div> -->
					<div class="p-3">
						<form:textarea path="workCntnt" class="form-control"  rows="5" placeholder="" />
					</div>
					
					<div class="row p-3">
						<div class="col-2">
							<i class="fas fa-clock fa-2x "></i>
						</div>
						<div class="col-10">
							<form:hidden path="workState" />						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="request">ìš”ì²­</button>						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="ing">ì§„í–‰</button>						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="complete">ì™„ë£Œ</button>						
							<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="issue">ì´ìŠˆ</button>						
						</div>
					</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-user-alt fa-2x "></i>
								</div>
								<div class="col-9 dropdown">
									<div class="col-auto"> 	
									
									  <button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropMember" data-bs-toggle="dropdown" aria-expanded="false">
									    ë‹´ë‹¹ì
									  </button>
									<ul class="dropdown-menu" aria-labelledby="dropMember">
									 	<c:forEach var="empVO" items="${list }">
										<li><a class="dropdown-item projmem" href="#" data-empId="${empVO.empId }">${empVO.empName }</a></li>
										</c:forEach>
									</ul>
									</div>
									<div id="mngrDiv" class="col-auto"> </div>
								</div> 
							</div>
						</div> 
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workStrtDt" class="dateLabel">ì‹œì‘ì¼ì</label>
									<input type="hidden" class="form-control" name="oldWorkStrtDt" type="date" />						
									<form:input class="form-control" path="workStrtDt" type="date" />
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workEndDt" class="dateLabel">ë§ˆê°ì¼ì</label>
									<input type="hidden" class="form-control" name="oldWorkEndDt" type="date" />						
									<form:input class="form-control" path="workEndDt" type="date" />						
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-flag fa-2x "></i>
								</div>
								<div class="col-10 dropdown">
									<form:hidden path="workPriority" />						
									<button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropPriority" data-bs-toggle="dropdown" aria-expanded="false">
									    ì—…ë¬´ìˆœìœ„
									 </button>
									<ul class="dropdown-menu" aria-labelledby="dropPriority">
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë‚®ìŒ" ><i class="fa fa-arrow-down icon"  style="color:orange"></i>ë‚®ìŒ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë³´í†µ"><span class="icon">â–</span>ë³´í†µ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë†’ìŒ" ><i class="fa fa-arrow-up icon"  style="color:green"></i>ë†’ìŒ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ê¸´ê¸‰" ><span class="icon">ğŸš¨</span>ê¸´ê¸‰</a></li>
									</ul>
								</div>    
							
							</div>
						</div>
					
<!-- 					<div class="modal-footer"> -->
<!-- 						<button type="button" class="btn btn-secondary" -->
<!-- 							data-bs-dismiss="modal">ì·¨ì†Œ</button> -->
<!-- 						<button type="submit" id="okBtn" class="btn btn-primary">í™•ì¸</button> -->
<!-- 					</div> -->
					<sec:csrfInput/>
				</form:form>
         </div>
     </div> <!-- end detail offcanvas -->
	

    <!-- update Modal -->
	<div class="modal" id="updateWorkModal" tabindex="-1">
		<div class="modal-dialog" >
			<div class="modal-content">
				<form:form modelAttribute="projWorkVO" method="POST" action="/project/updateWork" enctype="multipart/form-data">
					<div class="modal-header">
						<h5 class="modal-title">ì—…ë¬´ìˆ˜ì •</h5>
						
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
							<form:hidden path="projId" value="${projWorkVO.projId }"/>						
							<form:hidden path="workId" value=""/>		
							<sec:authentication property="principal.user" var="user"/>				
							<form:hidden path="workRqstr" value="${user.username }"/>		
						<div class="row p-3">
							<form:input class="form-control form-control-lg" path="workTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />						
						</div>
						<div class="row p-3">
							<div class="col-2">
								<i class="fas fa-clock fa-2x "></i>
							</div>
							<div class="col-10">
								<form:hidden path="workState" />						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="request">ìš”ì²­</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="ing">ì§„í–‰</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="complete">ì™„ë£Œ</button>						
								<button type="button" class="btn btn-secondary btn-rounded waves-effect wkStateBtn" id="issue">ì´ìŠˆ</button>									
							</div>
						</div>
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-user-alt fa-2x "></i>
								</div>
								<div class="col-9 dropdown">
									<div class="col-auto"> 	
									
									  <button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropMember" data-bs-toggle="dropdown" aria-expanded="false">
									    ë‹´ë‹¹ì
									  </button>
									<ul class="dropdown-menu" aria-labelledby="dropMember">
									 	<c:forEach var="empVO" items="${list }">
										<li><a class="dropdown-item projmem" href="#" data-empId="${empVO.empId }">${empVO.empName }</a></li>
										</c:forEach>
									</ul>
									</div>
									<div id="mngrDiv" class="col-auto"> </div>
								</div> 
							</div>
						</div> 
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workStrtDt" class="dateLabel">ì‹œì‘ì¼ì</label>
									<form:input class="form-control" path="workStrtDt" type="date" />						
								
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-calendar fa-2x "></i>
								</div>
								<div class="col-10">
									<label for="workEndDt" class="dateLabel">ë§ˆê°ì¼ì</label>
									<form:input class="form-control" path="workEndDt" type="date" />						
								</div>
							</div>
						</div>
						
						<div class="p-3">
							<div class="row">
								<div class="col-2">
									<i class="fas fa-flag fa-2x "></i>
								</div>
								<div class="col-10 dropdown">
									<form:hidden path="workPriority" />						
									<button class="btn btn-outline-secondary waves-effect dropdown-toggle" type="button" id="dropPriority" data-bs-toggle="dropdown" aria-expanded="false">
									    ì—…ë¬´ìˆœìœ„
									 </button>
									<ul class="dropdown-menu" aria-labelledby="dropPriority">
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë‚®ìŒ" ><i class="fa fa-arrow-down icon"  style="color:orange"></i>ë‚®ìŒ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë³´í†µ"><span class="icon">â–</span>ë³´í†µ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ë†’ìŒ" ><i class="fa fa-arrow-up icon"  style="color:green"></i>ë†’ìŒ</a></li>
										<li><a class="dropdown-item priorityBtn" href="#" data-priority = "ê¸´ê¸‰" ><span class="icon">ğŸš¨</span>ê¸´ê¸‰</a></li>
									</ul>
								</div>    
							
							</div>
						</div>
						
						<div class="p-3">
							<form:textarea path="workCntnt" class="form-control"  rows="5" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" />
						</div>
						
						<div class="p-3">
							<input type="file" class="form-control" name="uploadFile" multiple />
						</div>
						
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<button type="submit" id="okBtn" class="btn btn-primary">í™•ì¸</button>
					</div>
					<sec:csrfInput/>
				</form:form>	
			</div>
		</div>
	</div> <!-- end insert Modal  -->
	
<script type="text/javascript">
// function datailCilck(){
// 	console.log();
// }
function removeClass(p_obj, p_list){
//	 	console.log(p_obj);
	for(var i=0; i<p_list.length; i++){
		$(p_obj).removeClass(p_list[i]);
//	 		console.log(p_list[i]);
	}
}

function toStringByFormat(date) { 
	var year = date.getFullYear();
	var month = ('0' + (date.getMonth() + 1)).slice(-2);
	var day = ('0' + date.getDate()).slice(-2);

	var dateString = year + '-' + month  + '-' + day;
	
	return dateString;
}
	

function wkStateBtnClick(p_btn){
	var wkState = $(p_btn).text();
	var removeList = ["btn-info", "btn-success", "btn-dark", "btn-danger"];
	removeClass(".wkStateBtn", removeList);

	$(".wkStateBtn").addClass("btn-secondary"); 
	
	if(wkState=="ìš”ì²­"){
	$(p_btn).addClass("btn-info");
	}
	if(wkState=="ì§„í–‰"){
	$(p_btn).addClass("btn-success");
	}
	if(wkState=="ì™„ë£Œ"){
	$(p_btn).addClass("btn-dark");
	}
	if(wkState=="ì´ìŠˆ"){
	$(p_btn).addClass("btn-danger");
	}
	
	$("#workState").val(wkState);
}

function priorityBtnClick(p_btn){
	var priority = $(p_btn).data("priority")
	
	var priorityBtn = $(p_btn).parents('.dropdown').find("#dropPriority");
	
	
	var removeList = ["btn-outline-secondary", "btn-outline-warning", "btn-outline-dark", "btn-outline-success", "btn-outline-danger"];
	removeClass(priorityBtn, removeList)

	
	var code = "";
	if(priority=="ë‚®ìŒ"){
		code += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ë‚®ìŒ'; 	
		priorityBtn.html(code);
		priorityBtn.addClass("btn-outline-warning"); 
	}
	if(priority=="ë³´í†µ"){
		priorityBtn.text($(p_btn).text());
		priorityBtn.addClass("btn-outline-dark"); 
		
	}
	if(priority=="ë†’ìŒ"){
			
		code += '<i class="fa fa-arrow-down icon" style="color:green"></i>ë†’ìŒ'; 	
		priorityBtn.html(code);
		
		priorityBtn.addClass("btn-outline-success"); 
		
	}
	if(priority=="ê¸´ê¸‰"){
		priorityBtn.text($(p_btn).text());
		priorityBtn.addClass("btn-outline-danger"); 
			
	}
	
	$(p_btn).parents('.dropdown').find('input[name=workPriority]').val(priority);

// 	$("input[name='workPriority']").val(priority);
}
$(function(){

// 	$('[data-toggle="tooltip"]').tooltip();   

	// ajax Post ì‚¬ìš©ì‹œ ê°™ì´ ë³´ë‚¼ í† í°í—¤ë” 
	var token = '${_csrf.token}'
	var header = '${_csrf.headerName}'
	
	// ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
	workList();
	 
	// ì—…ë¬´ì¶”ê°€ ë²„íŠ¼ í´ë¦­ì‹œ ëª¨ë‹¬ ë³´ì—¬ì§
	$("#insertWorkBtn").on("click", function(){
		$("#insertWorkModal").modal("show");
		
		$("#mngrDiv").empty();
	})
	
	// ------------ì¸ì„œíŠ¸ ì—…ë°ì´íŠ¸ ëª¨ë‹¬ì•ˆì—ì„œ ì´ë²¤íŠ¸---------------
	// ë‹´ë‹¹ì í´ë¦­ì‹œ í•´ë‹¹ ë‹´ë‹¹ì ì¶”ê°€ë¨ 
	$(".projmem").on("click", function(){
		var memlist = [];
		memlist = $(".membtn");
		
		// ì¤‘ë³µì´ë¦„ ì„ íƒì‹œ ë¦¬í„´
		for(var i=0; i<memlist.length; i++){
			if($(this).text()==memlist[i].innerText){
				return false;
			}
		}
		
		// ì´ë¦„ë“¤ì–´ê°„ ë²„íŠ¼ ë§Œë“¤ê¸°
		var btn = "<button type='button' class='btn btn-outline-info waves-effect waves-light membtn'>";
		btn += "<i class='ri-close-line align-middle me-2'></i>";
		btn += $(this).text();
		btn += "</button>";
		// ì„ íƒí•œ ì´ë¦„ VOì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ íˆë“ ìœ¼ë¡œ ë„£ì–´ë†“ê¸°
		btn += '<input id="workMngr" name="workMngr" value="'+$(this).data("empId")+'" type="hidden">';
		var mngrDiv = $(this).parents(".dropdown").find("#mngrDiv")
		
		$(mngrDiv).append(btn);
		
	})
	
	// ì¶”ê°€ëœ ë‹´ë‹¹ìë²„íŠ¼ì— ìˆëŠ” xí´ë¦­ì‹œ ë‹´ë‹¹ì ì‚­ì œë¨
	$(document).on("click","#insertWorkModal .ri-close-line, #updateWorkModal .ri-close-line", function(){
// 		console.log($(this).parents(".btn"));
		var memBtn = $(this).parents(".btn")[0];
// 		console.log($(this).parents(".btn")[0].innerText);
		var memNm = memBtn.innerText;
		// íˆë“ íƒœí¬ ì—†ì• ê¸°
		$(memBtn).parents("#mngrDiv").find("input[value="+memNm+"]").remove();
		// ë²„íŠ¼ ì—†ì• ê¸°
		$(memBtn).remove();
	})
	
	// ì—…ë¬´ìš°ì„ ë„ í´ë¦­ì‹œ 
	$("#insertWorkModal .priorityBtn, #updateWorkModal .priorityBtn").on("click", function(){
// 		console.log($(this).attr("priority"));
		priorityBtnClick(this);
// 		$(this).parents('.dropdown').find('input[name=workPriority]').val(priority);
		
	})
	
	// ì—…ë¬´ìƒíƒœ ë²„íŠ¼ í´ë¦­ì‹œ 
	$("#insertWorkModal .wkStateBtn, #updateWorkModal .wkStateBtn").on("click", function(){
		wkStateBtnClick(this);

	})
	
	// ------------ì¸ì„œíŠ¸ ì—…ë°ì´íŠ¸ ëª¨ë‹¬ì•ˆì—ì„œ ì´ë²¤íŠ¸ ë---------------
// 	console.log(priorityList);
// 	console.log(wkStateList);
	
	// ì‚¬ì´ë“œíƒ­ í´ë¦­ì‹œ 
	$(".sideBox").on("click", function(){
		workList();
		
	})
	
	// ------------ë””í…Œì¼ í´ë¦­ì‹œ ì´ë²¤íŠ¸---------------
	$(document).on("click",".wkDetail", function(){
		console.log("*wkDetail test");
		var workId = $(this).children(".workId").text();
		console.log(workId);
		
		$.ajax({
			url: "/project/workDetail",
			type: "POST",
			dataType: "json",
			data: {
				'workId' : workId		
			},
			success: function(res) {
				console.log(res);
				// ì—…ë¬´ì½”ë“œ
				$("#wokrDetail #workId").val(res.workId);
				// ì œëª©
				$("#wokrDetailLabel").text(res.workTitle);			
				// ë‚´ìš©
				$("#wokrDetail #workCntnt").text(res.workCntnt);
				// ìƒíƒœ
				$("#wokrDetail #workState").val(res.workState);
				var removeList = ["btn-info", "btn-success", "btn-dark", "btn-danger"];
				removeClass(".wkStateBtn", removeList);
				
				if(res.workState=="ìš”ì²­"){
					$("#wokrDetail #request").addClass("btn-info");
				}
				if(res.workState=="ì§„í–‰"){
					$("#wokrDetail #ing").addClass("btn-success");
				}
				if(res.workState=="ì™„ë£Œ"){
					$("#wokrDetail #complete").addClass("btn-dark");
				}
				if(res.workState=="ì´ìŠˆ"){
					console.log(res.workState);
					$("#wokrDetail #issue").addClass("btn-danger");
				}
				
				
				
				// ë‹´ë‹¹ì
				$("#wokrDetail #mngrDiv").empty()
				for(var i=0; i<res.workMngr.length; i++){
					
					// ì´ë¦„ë“¤ì–´ê°„ ë²„íŠ¼ ë§Œë“¤ê¸°
					var btn = "<button type='button' class='btn btn-outline-info waves-effect waves-light membtn'>";
					btn += "<i class='ri-close-line align-middle me-2'></i>";
					btn += res.workMngr[i];
					btn += "</button>";
					// ì„ íƒí•œ ì´ë¦„ VOì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ íˆë“ ìœ¼ë¡œ ë„£ì–´ë†“ê¸°
					btn += '<input id="workMngr" name="workMngr" value="'+ res.workMngr[i] +'" type="hidden">';
					
					$("#wokrDetail #mngrDiv").append(btn);
				}
				
				// ë‚ ì§œ
				var workStrtDt = toStringByFormat(new Date(res.workStrtDt))
				var workEndDt = toStringByFormat(new Date(res.workEndDt))
				$("#wokrDetail input[name=oldWorkStrtDt]").val(workStrtDt);
				$("#wokrDetail input[name=oldWorkEndDt]").val(workEndDt);
				$("#wokrDetail #workStrtDt").val(workStrtDt);
				$("#wokrDetail #workEndDt").val(workEndDt);
				
				// ì—…ë¬´ìˆœìœ„
				$("#wokrDetail #workPriority").val(res.workPriority);
				var removeList = ["btn-outline-secondary", "btn-outline-warning", "btn-outline-dark", "btn-outline-success", "btn-outline-danger"];
				removeClass("#wokrDetail #dropPriority", removeList)
				
				code = "";
				if(res.workPriority=="ë‚®ìŒ"){
					code += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ë‚®ìŒ'; 
					$("#wokrDetail #dropPriority").addClass("btn-outline-warning"); 
				}
				if(res.workPriority=="ë³´í†µ"){
					code += '<span class="icon">â–</span>ë³´í†µ'; 	
					$("#wokrDetail #dropPriority").addClass("btn-outline-dark"); 
					
				}
				if(res.workPriority=="ë†’ìŒ"){
						
					code += '<i class="fa fa-arrow-down icon" style="color:green"></i>ë†’ìŒ'; 	
					$("#wokrDetail #dropPriority").addClass("btn-outline-success"); 
					
				}
				if(res.workPriority=="ê¸´ê¸‰"){
					code += '<span class="icon">ğŸš¨</span>ê¸´ê¸‰'; 	
					$("#wokrDetail #dropPriority").addClass("btn-outline-danger"); 
						
				}
					$("#wokrDetail #dropPriority").html(code);
				
				
						
			},
			beforeSend:function(xhr) { 
				xhr.setRequestHeader(header, token)
			},
			error: function(xhr) {
				alert(xhr.status)
			
			}
		})
		
	})
	
	// ------------ë””í…Œì¼ í´ë¦­ì‹œ ì´ë²¤íŠ¸ ë---------------
	
	// ------------ë””í…Œì¼ ì°½ ì•ˆì— ë°ì´í„° í´ë¦­ì‹œ ì´ë²¤íŠ¸ ----------
	// ìƒíƒœë²„íŠ¼ í´ë¦­ì‹œ
	$("#wokrDetail .wkStateBtn").on("click", function(){
		Swal.fire(
				{ title: 'ìƒíƒœë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
// 						, text: "ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'í™•ì¸'
						, cancelButtonText: 'ì·¨ì†Œ' 
				}).then((result) => { 
						if (result.isConfirmed) { 
							Swal.fire( '', 'ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success' ) 
							wkStateBtnClick(this);
						} 
				})
        	
	})	
	
	// ë‹´ë‹¹ì Xí´ë¦­ì‹œ
	$(document).on("click", "#wokrDetail .ri-close-line", function(){
		Swal.fire(
				{ title: 'ë‹´ë‹¹ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
// 						, text: "ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'í™•ì¸'
						, cancelButtonText: 'ì·¨ì†Œ' 
				}).then((result) => { 
						if (result.isConfirmed) { 
							$(this).parents(".btn").remove();
						} 
				})
        	
	})	
	// ë‚ ì§œë²„íŠ¼ í´ë¦­ì‹œ
	$("#wokrDetail #workStrtDt").on('focusin', function(){
	    console.log("Saving value " + $(this).val());
	    $(this).data('old', $(this).val());
	});
	// ì—…ë¬´ìƒíƒœ í´ë¦­ì‹œ
	$("#wokrDetail #workStrtDt").on("change", function(){
// 		alert($("#wokrDetail input[name=oldWorkStrtDt]").val());
		oldvalue =  $(this).data('old');
		Swal.fire(
				{ title: 'ìƒíƒœë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
// 						, text: "ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'í™•ì¸'
						, cancelButtonText: 'ì·¨ì†Œ' 
				}).then((result) => { 
						if (!result.isConfirmed) { 
// 							Swal.fire( '', 'ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success' ) 
							$(this).val(oldvalue);
						} 
				})
        	
	})
	
	// ì—…ë¬´ìš°ì„ ë„ í´ë¦­ì‹œ 
	$("#wokrDetail .priorityBtn").on("click", function(){
		Swal.fire(
				{ title: 'ì—…ë¬´ ìš°ì„ ë„ë¥¼ ë°”ê¾¸ì‹œê² ìŠµë‹ˆê¹Œ?'
// 						, text: "ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”."
						, icon: 'warning', showCancelButton: true
						, confirmButtonColor: '#3085d6'
						, cancelButtonColor: '#d33'
						, confirmButtonText: 'í™•ì¸'
						, cancelButtonText: 'ì·¨ì†Œ' 
				}).then((result) => { 
						if (result.isConfirmed) { 
							priorityBtnClick(this);
						} 
				})
		
	})
	
	// ìˆ˜ì •ë²„íŠ¼ í´ë¦­ì‹œ 
	$("#wokrDetail #wkUpdate").on("click", function(){
		$("#updateWorkModal").modal("show");
		console.log("*wkUpdate test");
		var workDetail = $(this).parents("#wokrDetail");
		var workId = workDetail.find("#workId").val();
		var workStartDt = workDetail.find("input[name=oldWorkStrtDt]").val();
		var workEndDt = workDetail.find("input[name=oldWorkEndDt]").val();
		var workState = workDetail.find("#workState").val();
		var workPriority = workDetail.find("#workPriority").val();
		var workTitle = workDetail.find("#wokrDetailLabel").text();
		var workCntnt = workDetail.find("#workCntnt").val();
		var workMngrObj = workDetail.find("input[name=workMngr]");
		var workMngr = []
		for(var i=0; i<workMngrObj.length; i++){
			workMngr.push(workMngrObj[i].value)
			console.log(workMngr[i]);
		}
		
		console.log(workId);
		console.log(workStartDt);
		console.log(workEndDt);
		console.log(workState);
		console.log(workPriority);
		console.log(workTitle);
		console.log(workCntnt);
		
		// ì—…ë¬´ì½”ë“œ
		$("#updateWorkModal #workId").val(workId);
		// ì œëª©
		$("#updateWorkModal #workTitle").val(workTitle);			
		// ë‚´ìš©
		$("#updateWorkModal #workCntnt").text(workCntnt);
		// ìƒíƒœ
		$("#updateWorkModal #workState").val(workState);
		var removeList = ["btn-info", "btn-success", "btn-dark", "btn-danger"];
		removeClass(".wkStateBtn", removeList);
		
		if(workState=="ìš”ì²­"){
			$("#updateWorkModal #request").addClass("btn-info");
		}
		if(workState=="ì§„í–‰"){
			$("#updateWorkModal #ing").addClass("btn-success");
		}
		if(workState=="ì™„ë£Œ"){
			$("#updateWorkModal #complete").addClass("btn-dark");
		}
		if(workState=="ì´ìŠˆ"){
			$("#updateWorkModal #issue").addClass("btn-danger");
		}
		
		
		
		// ë‹´ë‹¹ì
		$("#updateWorkModal #mngrDiv").empty()
		for(var i=0; i<workMngr.length; i++){
			
			// ì´ë¦„ë“¤ì–´ê°„ ë²„íŠ¼ ë§Œë“¤ê¸°
			var btn = "<button type='button' class='btn btn-outline-info waves-effect waves-light membtn'>";
			btn += "<i class='ri-close-line align-middle me-2'></i>";
			btn += workMngr[i];
			btn += "</button>";
			// ì„ íƒí•œ ì´ë¦„ VOì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ íˆë“ ìœ¼ë¡œ ë„£ì–´ë†“ê¸°
			btn += '<input id="workMngr" name="workMngr" value="'+ workMngr[i] +'" type="hidden">';
			
			$("#updateWorkModal #mngrDiv").append(btn);
		}
		
		// ë‚ ì§œ
// 		var sworkStrtDt = toStringByFormat(new Date(workStrtDt))
// 		var sworkEndDt = toStringByFormat(new Date(workEndDt))
// 		$("#updateWorkModal input[name=oldWorkStrtDt]").val(workStrtDt);
// 		$("#updateWorkModal input[name=oldWorkEndDt]").val(workEndDt);
		$("#updateWorkModal #workStrtDt").val(workStartDt);
		$("#updateWorkModal #workEndDt").val(workEndDt);
		
		// ì—…ë¬´ìˆœìœ„
		$("#updateWorkModal #workPriority").val(workPriority);
		var removeList = ["btn-outline-secondary", "btn-outline-warning", "btn-outline-dark", "btn-outline-success", "btn-outline-danger"];
		removeClass("#updateWorkModal #dropPriority", removeList)
		
		code = "";
		if(workPriority=="ë‚®ìŒ"){
			code += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ë‚®ìŒ'; 
			$("#updateWorkModal #dropPriority").addClass("btn-outline-warning"); 
		}
		if(workPriority=="ë³´í†µ"){
			code += '<span class="icon">â–</span>ë³´í†µ'; 	
			$("#updateWorkModal #dropPriority").addClass("btn-outline-dark"); 
			
		}
		if(workPriority=="ë†’ìŒ"){
				
			code += '<i class="fa fa-arrow-down icon" style="color:green"></i>ë†’ìŒ'; 	
			$("#updateWorkModal #dropPriority").addClass("btn-outline-success"); 
			
		}
		if(workPriority=="ê¸´ê¸‰"){
			code += '<span class="icon">ğŸš¨</span>ê¸´ê¸‰'; 	
			$("#updateWorkModal #dropPriority").addClass("btn-outline-danger"); 
				
		}
			$("#updateWorkModal #dropPriority").html(code);
		
		
		
	})
	
	//---------------ìˆ˜ì •ëª¨ë‹¬ ì•ˆì—ì„œ ì´ë²¤íŠ¸ ---------------
	
	//---------------ìˆ˜ì •ëª¨ë‹¬ ì•ˆì—ì„œ ì´ë²¤íŠ¸ ë ---------------
	
	// ------------ë””í…Œì¼ ì°½ ì•ˆì— ë°ì´í„° í´ë¦­ì‹œ ì´ë²¤íŠ¸ ë----------

	
	function workList(){
		
//		console.log($(this).val());
//		division = $(this).val();`
		var division = $("input[name='division']:checked").val();
//	 	console.log(division);
		
		var wkStateObj = $("input[name='wkState']:checked");
//	 	console.log(wkStateObj);
		
		var priorityObj = $("input[name='priority']:checked");
//	 	console.log(priorityObj);

		if(wkStateObj.length < 1 || priorityObj.length < 1){
			alert("ìµœì†Œ í•œ ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”!")
			event.preventDefault()
			return false;
		}
		
		var wkStateList = []; 
		for(var i=0; i<wkStateObj.length; i++){
//	 		console.log(wkStateObj[i].value);
			wkStateList.push(wkStateObj[i].value)
		}
		
		var priorityList= []; 
		for(var i=0; i<priorityObj.length; i++){
//	 		console.log(wkStateObj[i].value);
			priorityList.push(priorityObj[i].value)
		}
		
		$.ajax({
			url: "/project/workList",
			type: "POST",
			contentType : "application/json; charset=utf-8",
			data: JSON.stringify({'empId' : "EMPL00004"
				,'projId' : "${projWorkVO.projId}"
				,'division' : division
				,'wkStateList' : wkStateList
				,'priorityList' : priorityList
			}),
			success: function(res) {
//					console.log(res);

				var tbody = "";
				$.each(res, function(i, v) {
					
//						var workId = "'" + v.workId + "'";
					tbody += '<tr class="wkDetail" data-bs-toggle="offcanvas" data-bs-target="#wokrDetail" aria-controls="wokrDetail" >';
					tbody += '<td class="workId" >'+v.workId+'</td>';
					tbody += '<td>';
					if(v.workState==null){
						tbody += '-';
					}
					if(v.workState=="ìš”ì²­"){
						tbody += '<button type="button" class="btn btn-sm btn-info btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					if(v.workState=="ì§„í–‰"){
						tbody += '<button type="button" class="btn btn-sm btn-success btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					if(v.workState=="ì™„ë£Œ"){
						tbody += '<button type="button" class="btn btn-sm btn-dark btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					if(v.workState=="ì´ìŠˆ"){
						tbody += '<button type="button" class="btn btn-sm btn-danger btn-rounded waves-effect ">'+v.workState +'</button>';
					}
					tbody += '</td>';
					
					// ìˆœìœ„
					if(v.workPriority==null){
						tbody += '<td>-</td>';
					}else{
		                tbody += '<td>';
						
						if(v.workPriority=="ë‚®ìŒ"){
							tbody += '<i class="fa fa-arrow-down icon" style="color:orange"></i>ë‚®ìŒ'; 	
						}
						if(v.workPriority=="ë³´í†µ"){
							tbody += '<span class="icon">â–</span>ë³´í†µ'; 	
							
						}
						if(v.workPriority=="ë†’ìŒ"){
							tbody += '<i class="fa fa-arrow-down icon" style="color:green"></i>ë†’ìŒ'; 	
							
						}
						if(v.workPriority=="ê¸´ê¸‰"){
							tbody += '<span class="icon">ğŸš¨</span>ê¸´ê¸‰'; 	
								
						}
		                tbody += '</td>';
					}   
					
	                tbody += '<td>'+v.workTitle +'</td>';

	                if(v.workMngr.length == 1){
		                tbody += '<td>' + v.workMngr[0] + '</sapn></td>';
	                }else if(v.workMngr.length > 1){
		                tbody += '<td><span data-bs-toggle="tooltip" data-bs-placement="bottom" title="';
						for(var i=0; i < v.workMngr.length; i++){
							tbody += v.workMngr[i];
							if(i != (v.workMngr.length-1)){
								tbody += ", ";
							}
						}
		        
		                tbody += '">' + v.workMngr[0] + 'ì™¸ '+ (v.workMngr.length-1) +'ëª…</sapn> </td>';
	                }else{
	                	tbody += '<td> - </td>';
	                	
	                }
	                
	                tbody += '<td>'+ toStringByFormat(new Date(v.workMdfyDt)) +'</td>';
	                tbody += '</tr>';
	                
	            
				})
				
				$("#tbody").html(tbody);
				
				var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
				var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
				  return new bootstrap.Tooltip(tooltipTriggerEl)
				})
				
			},
			error: function(xhr) {
				alert(xhr.status)

			},
			beforeSend:function(xhr) { 
				xhr.setRequestHeader(header, token)
			},
			dataType: "json"
		})
	}	
	
	
})
</script>
