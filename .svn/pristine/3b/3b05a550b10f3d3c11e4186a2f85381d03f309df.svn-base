<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.workTogether.attach.mapper.AttachMapper">

	<!-- attach 테이블로 첨부파일 insert -->
	<insert id="insertAttachFiles" parameterType="attachVO">
		<foreach collection="list" item="item" index="index"
			open="INSERT ALL " separator=" " close="SELECT * FROM DUAL">
			INTO attach (
			atch_id
			,atch_rel_id
			,atch_path
			,atch_name
			,atch_oldname
			,atch_extns
			,atch_wrt_date
			) VALUES (
			(SELECT
			'ATTA'||LPAD(NVL(MAX(SUBSTR(ATCH_ID,5,5)),0)+1,5,'0') FROM ATTACH)
			,#{item.atchRelId}
			,#{item.atchPath}
			,#{item.atchName}
			,#{item.atchOldname}
			,#{item.atchExtns}
			,SYSDATE
			)
		</foreach>
	</insert>

	<select id="selectFileList" parameterType="hashmap"
		resultType="hashmap">
		<![CDATA[
			SELECT 
		 		ATCH_ID,
		    	ATCH_NAME
			FROM ATTACH
			WHERE ATCH_REL_ID = #{atchRelId}
		]]>
	</select>

</mapper>












