package kr.or.workTogether.memo.controller;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Controller;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import kr.or.workTogether.common.vo.EmployeeVO;
import kr.or.workTogether.common.vo.MemoVO;
import kr.or.workTogether.email.controller.EmailController;
import kr.or.workTogether.memo.service.MemoService;
import kr.or.workTogether.security.CustomUser;

@Controller
@RequestMapping("/memo")
public class MemoController {
	private static final Logger logger = LoggerFactory.getLogger(EmailController.class);

	@Autowired
	MemoService memoService;

	// 메모 작성하기 Get
	@GetMapping("/writeMemo")
	public String getInsertMemo(@ModelAttribute MemoVO memoVO) {
		return "memo/writeMemo";
	}

	// 메모 작성하기 POST
	@PostMapping("/writeMemo")
	public String postInsertMemo(@Validated @ModelAttribute MemoVO memoVO, Authentication auth) {
		CustomUser user = (CustomUser) auth.getPrincipal();
		EmployeeVO userInfo = user.getUser();
		memoVO.setMemoWrtr(userInfo.getUsername());
		
		memoService.writeMemo(memoVO);

		return "memo/selectMemo";

	}

}
