<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>

<script
	src="https://cdn.ckeditor.com/ckeditor5/33.0.0/decoupled-document/ckeditor.js"></script>

<style>
</style>
<sec:authentication property="principal.user" var="user" />
<input type="hidden" id="userId" value="${user.username }">
<input type="hidden" id="userPhoto" value="${user.atchPath }">
<input type="hidden" id="token" value="${_csrf.token }">
<input type="hidden" id="header" value="${_csrf.headerName }">

<div class="row">
	<div class="col-lg-12">
		<div class="card">
			<div class="card-body">

				<%@ include file="includeTab.jsp"%>

				<div class="row">

					<div class="col-lg-2">
						<%@ include file="includeSide.jsp"%>
					</div>
					<!-- col end -->

					<div class="col-lg-9 ">
						<div class="row mb-3">
							<!-- 							<div class="col-2 alert alert-primary" role="alert"> -->
							<!-- 								  ÏµúÏÜå Ìïú Í∞ú  -->
							<!-- 							</div> -->
							<div class="col-4">
								<form class="app-search d-none d-lg-block">
									<div class="position-relative">
										<input type="text" id="" class="form-control"
											placeholder="Search..."> <span
											class="ri-search-line"></span>
									</div>
								</form>
							</div>
							<div class="col-6">
								<button type="button" id="insertWorkBtn"
									class="btn btn-dark btn-rounded waves-effect waves-light">
									ÏóÖÎ¨¥Ï∂îÍ∞Ä</button>
							</div>
						</div>
						<!-- row end -->

						<div class="row">
							<div class="table-responsive">
								<table id="selection-datatable"
									class="table dt-responsive nowrap w-100">
									<thead class="table-light">
										<tr>
											<th>Î≤àÌò∏</th>
											<th>ÏÉÅÌÉú</th>
											<th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
											<th>ÏóÖÎ¨¥ÎÇ¥Ïö©</th>

											<th>Îã¥ÎãπÏûê</th>
											<th>ÏàòÏ†ïÏùºÏãú</th>
										</tr>
									</thead>
									<tbody id="tbody">



									</tbody>
								</table>

							</div>
							<!-- end table-->

						</div>
						<!-- row end -->

					</div>
					<!-- col end -->

				</div>
				<!-- end row-->
			</div>
			<!-- end card body-->
		</div>
		<!-- end card -->
	</div>
</div>

<!-- 	<div class="alert alert-primary alert-dismissible fade" role="alert"> -->
<!-- 		<font style="vertical-align: inherit;"> -->
<!-- 			<font style="vertical-align: inherit;"> -->
<!--         	ÏµúÏÜå Ìïú Í∞ú Ïù¥ÏÉÅ Ï≤¥ÌÅ¨ÌïòÏÑ∏Ïöî! -->
<!--         	</font> -->
<!--         </font> -->
<!--         <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Îã´Í∏∞"> -->
<!--         </button> -->
<!--     </div> -->


<%@ include file="modal.jsp"%>

<script type="text/javascript">

// ajax Post ÏÇ¨Ïö©Ïãú Í∞ôÏù¥ Î≥¥ÎÇº ÌÜ†ÌÅ∞Ìó§Îçî 
var token = $("#token").val();
var header = $("#header").val();

	
    $(function () {

        // 	$('[data-toggle="tooltip"]').tooltip();   

        
        var userId = $("#userId").val();
        var userPhoto = $("#userPhoto").val();
        var projId = $("#projId").val();
//         console.log(userId);
//         console.log(userPhoto);

        // Î¶¨Ïä§Ìä∏ Í∞ÄÏ†∏Ïò§Í∏∞
        workList();
        
       
		
		// ÏóÖÎ¨¥Î¶¨Ïä§Ìä∏
	    function workList() {

	        //		console.log($(this).val());
	        //		division = $(this).val();`
	        var division = $("input[name='division']:checked").val();
	        //	 	console.log(division);

	        var wkStateObj = $("input[name='wkState']:checked");
	        //	 	console.log(wkStateObj);

	        var priorityObj = $("input[name='priority']:checked");
	        //	 	console.log(priorityObj);

	        if (wkStateObj.length < 1 || priorityObj.length < 1) {
	            alert("ÏµúÏÜå Ìïú Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!")
	            event.preventDefault()
	            return false;
	        }

	        var wkStateList = [];
	        for (var i = 0; i < wkStateObj.length; i++) {
	            //	 		console.log(wkStateObj[i].value);
	            wkStateList.push(wkStateObj[i].value)
	        }

	        var priorityList = [];
	        for (var i = 0; i < priorityObj.length; i++) {
	            //	 		console.log(wkStateObj[i].value);
	            priorityList.push(priorityObj[i].value)
	        }

	        $.ajax({
	            url: "/project/workList",
	            type: "POST",
	            contentType: "application/json; charset=utf-8",
	            data: JSON.stringify({
	                'empId': userId,
	                'projId': projId,
	                'division': division,
	                'wkStateList': wkStateList,
	                'priorityList': priorityList
	            }),
	            success: function (res) {
	                //					console.log(res);

	                var tbody = "";
	                $.each(res, function (i, v) {

	                    //						var workId = "'" + v.workId + "'";
	                    tbody +=
	                        '<tr class="wkDetail" data-bs-toggle="offcanvas" data-bs-target="#wokrDetail" aria-controls="wokrDetail" >';
	                    tbody += '<td class="workId" >' + v.workId + '</td>';
	                    tbody += '<td>';
	                    if (v.workState == null) {
	                        tbody += '-';
	                    }
	                    if (v.workState == "ÏöîÏ≤≠") {
	                        tbody +=
	                            '<button type="button" class="btn btn-sm btn-info btn-rounded waves-effect ">' +
	                            v.workState + '</button>';
	                    }
	                    if (v.workState == "ÏßÑÌñâ") {
	                        tbody +=
	                            '<button type="button" class="btn btn-sm btn-success btn-rounded waves-effect ">' +
	                            v.workState + '</button>';
	                    }
	                    if (v.workState == "ÏôÑÎ£å") {
	                        tbody +=
	                            '<button type="button" class="btn btn-sm btn-dark btn-rounded waves-effect ">' +
	                            v.workState + '</button>';
	                    }
	                    if (v.workState == "Ïù¥Ïäà") {
	                        tbody += '<button type="button" class="btn btn-sm btn-danger btn-rounded waves-effect ">' +
	                            v.workState + '</button>';
	                    }
	                    tbody += '</td>';

	                    // ÏàúÏúÑ
	                    if (v.workPriority == null) {
	                        tbody += '<td>-</td>';
	                    } else {
	                        tbody += '<td>';

	                        if (v.workPriority == "ÎÇÆÏùå") {
	                            tbody +=
	                                '<i class="fa fa-arrow-down icon" style="color:orange"></i>ÎÇÆÏùå';
	                        }
	                        if (v.workPriority == "Î≥¥ÌÜµ") {
	                            tbody += '<span class="icon">‚ûñ</span>Î≥¥ÌÜµ';

	                        }
	                        if (v.workPriority == "ÎÜíÏùå") {
	                            tbody +=
	                                '<i class="fa fa-arrow-down icon" style="color:green"></i>ÎÜíÏùå';

	                        }
	                        if (v.workPriority == "Í∏¥Í∏â") {
	                            tbody += '<span class="icon">üö®</span>Í∏¥Í∏â';

	                        }
	                        tbody += '</td>';
	                    }

	                    tbody += '<td>' + v.workTitle + '</td>';

	                    if (v.workMngr.length == 1) {
	                        tbody += '<td>' + v.workMngr[0].workMngrNm + '</sapn></td>';
	                    } else if (v.workMngr.length > 1) {
	                        tbody +=
	                            '<td><span data-bs-toggle="tooltip" data-bs-placement="bottom" title="';
	                        for (var i = 0; i < v.workMngr.length; i++) {
	                            tbody += v.workMngr[i].workMngrNm;
	                            if (i != (v.workMngr.length - 1)) {
	                                tbody += ", ";
	                            }
	                        }

	                        tbody += '">' + v.workMngr[0].workMngrNm + 'Ïô∏ ' + (v.workMngr.length - 1) +
	                            'Î™Ö</sapn> </td>';
	                    } else {
	                        tbody += '<td> - </td>';

	                    }

	                    tbody += '<td>' + toStringYmd(new Date(v.workMdfyDt)) +
	                        '</td>';
	                    tbody += '</tr>';


	                })

	                $("#tbody").html(tbody);

	                var tooltipTriggerList = [].slice.call(document.querySelectorAll(
	                    '[data-bs-toggle="tooltip"]'))
	                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
	                    return new bootstrap.Tooltip(tooltipTriggerEl)
	                })

	            },
	            error: function (xhr) {
	                alert(xhr.status)

	            },
	            beforeSend: function (xhr) {
	                xhr.setRequestHeader(header, token)
	            },
	            dataType: "json"
	        })
	    }
  
}) // end $(function)
    
console.log("===== ", document.querySelector('#workCntnt'));
   ClassicEditor
   .create( document.querySelector( '#workCntnt' ) )
   .catch( error => {
       console.error( error );
   } );
    
</script>